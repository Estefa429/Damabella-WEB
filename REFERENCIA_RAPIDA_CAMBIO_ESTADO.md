# üìã REFERENCIA R√ÅPIDA: Funci√≥n Centralizada de Cambio de Estado\n\n## üéØ En una l√≠nea\n\n**Tienes una funci√≥n centralizada √∫nica que maneja TODOS los cambios de estado de pedidos, sin repeticiones de c√≥digo.**\n\n---\n\n## üì¶ 4 Archivos Nuevos\n\n| Archivo | Tipo | L√≠neas | Prop√≥sito |\n|---------|------|--------|----------|\n| `src/services/cambioEstadoCentralizado.ts` | Service | 398 | Funci√≥n principal + validadores + helpers |\n| `src/hooks/useCambioEstadoPedido.ts` | Hook | 95 | Hook React para componentes |\n| `src/components/EjemplosIntegracionCambioEstado.tsx` | Ejemplos | 450+ | 6 ejemplos listos para copiar-pegar |\n| `GUIA_CAMBIO_ESTADO_CENTRALIZADO.md` | Docs | 300+ | Documentaci√≥n completa |\n\n---\n\n## üöÄ Uso en 30 Segundos\n\n### Opci√≥n A: Con Hook (Recomendado en React)\n```typescript\nconst { cambiarEstado, cargando, puedeCompletarse } = useCambioEstadoPedido();\n\n<button \n  onClick={() => cambiarEstado(pedido.id, 'Completada')}\n  disabled={!puedeCompletarse(pedido.estado)}\n>\n  Completar\n</button>\n```\n\n### Opci√≥n B: Sin React (En servicios)\n```typescript\nawait cambiarEstadoPedidoCentralizado(\n  pedidoId, \n  'Completada',\n  { onSincronizarVentas: crearVenta }\n);\n```\n\n---\n\n## üõ°Ô∏è Validadores (1 l√≠nea cada uno)\n\n| Funci√≥n | Devuelve | Uso |\n|---------|----------|-----|\n| `puedeEditarse(estado)` | `boolean` | `{puedeEditarse(pedido.estado) && <formulario />}` |\n| `puedeAnularse(estado)` | `boolean` | `{puedeAnularse(pedido.estado) && <btnAnular />}` |\n| `puedeCompletarse(estado)` | `boolean` | `{puedeCompletarse(pedido.estado) && <btnCompletar />}` |\n| `esEstadoTerminal(estado)` | `boolean` | `if (esEstadoTerminal(estado)) return;` |\n\n---\n\n## üé® Helpers UI (1 l√≠nea cada uno)\n\n| Funci√≥n | Devuelve | Uso |\n|---------|----------|-----|\n| `obtenerClaseEstado(estado)` | `string` (CSS) | `<span className={obtenerClaseEstado(estado)}>` |\n| `obtenerDescripcionEstado(estado)` | `string` (texto) | `<p>{obtenerDescripcionEstado(estado)}</p>` |\n\n---\n\n## üìä Transiciones Implementadas\n\n```\nPendiente  ‚îÄ‚îÄCompletada‚îÄ‚îÄ> Completada  ‚îÄ‚îÄAnulado‚îÄ‚îÄ> Anulado\n‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄAnulado‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n\n‚ùå Bloqueadas:\n   Completada ‚Üí Pendiente  (no se puede revertir)\n   Anulado ‚Üí Cualquier     (estado terminal)\n```\n\n---\n\n## üîÑ Sincronizaci√≥n Autom√°tica\n\n**Cuando un pedido pasa a `Completada`:**\n1. ‚úÖ Se valida la transici√≥n\n2. ‚úÖ Se descuenta stock\n3. ‚úÖ Se llama a `onSincronizarVentas`\n4. ‚úÖ Se crea autom√°ticamente en m√≥dulo Ventas\n5. ‚úÖ Se notifica al usuario\n\n---\n\n## üß™ Matriz de Compatibilidad\n\n| Contexto | Funci√≥n | Hook | Ejemplo |\n|----------|---------|------|----------|\n| Componente React | ‚ùå | ‚úÖ | `useCambioEstadoPedido()` |\n| Servicio JS | ‚úÖ | ‚ùå | `cambiarEstadoPedidoCentralizado()` |\n| Evento onClick | ‚úÖ | ‚úÖ | Ambos funcionan |\n| Modal/Formulario | ‚ùå | ‚úÖ | Preferir hook |\n| Carga masiva | ‚úÖ | ‚ùå | Preferir funci√≥n |\n\n---\n\n## üìù Estado del Hook\n\n```typescript\n{\n  // Booleanos\n  cargando: boolean,              // true mientras procesa\n  error: string | null,           // Mensaje de error si falla\n  exito: boolean,                 // true despu√©s de √©xito\n  \n  // Datos\n  ultimoPedidoActualizado?: Pedido, // Pedido con nuevo estado\n  \n  // Funciones\n  cambiarEstado: (id, estado) => Promise<void>,\n  limpiarMensajes: () => void,\n  \n  // Validadores\n  puedeEditarse: (estado) => boolean,\n  puedeAnularse: (estado) => boolean,\n  puedeCompletarse: (estado) => boolean,\n  esEstadoTerminal: (estado) => boolean,\n  \n  // Helpers UI\n  obtenerClaseEstado: (estado) => string,\n  obtenerDescripcionEstado: (estado) => string\n}\n```\n\n---\n\n## ‚ö° Configuraci√≥n del Hook\n\n```typescript\nuseCambioEstadoPedido({\n  // Se ejecuta cuando cambia a Completada\n  onSincronizarVentas: (pedido) => crearVentaCallback(pedido),\n  \n  // Se ejecuta en cada evento (inicio, √©xito, error)\n  onNotificar: (tipo, mensaje) => mostrarToast(tipo, mensaje),\n  \n  // Si falla Ventas, ¬ørevertir o continuar?\n  continuarSiError: false // por defecto\n})\n```\n\n---\n\n## üö® Manejo de Errores (4 tipos)\n\n| C√≥digo | Causa | Soluci√≥n |\n|--------|-------|----------|\n| `PEDIDO_NO_ENCONTRADO` | Pedido no existe | Verificar ID |\n| `TRANSICION_NO_PERMITIDA` | Cambio inv√°lido | Revisar estado actual |\n| `ERROR_SINCRONIZACION_VENTAS` | Fallo con Ventas | Verificar callback |\n| `ERROR_INTERNO` | Error inesperado | Revisar logs |\n\n---\n\n## üì± Ejemplos por Caso de Uso\n\n| Necesidad | Archivo a Copiar | L√≠neas |\n|-----------|-----------------|-------|\n| Bot√≥n en tabla | `EjemplosIntegracionCambioEstado.tsx` | 25-50 |\n| Card de detalle | `EjemplosIntegracionCambioEstado.tsx` | 75-150 |\n| Modal de cambio | `EjemplosIntegracionCambioEstado.tsx` | 190-245 |\n| En servicio | `EjemplosIntegracionCambioEstado.tsx` | 270-310 |\n| Hook personalizado | `EjemplosIntegracionCambioEstado.tsx` | 330-375 |\n| Acciones masivas | `EjemplosIntegracionCambioEstado.tsx` | 405-450 |\n\n---\n\n## ‚úÖ Checklist de Integraci√≥n (5 pasos)\n\n1. ‚úì Importar hook: `import { useCambioEstadoPedido } from './hooks/useCambioEstadoPedido';`\n2. ‚úì Usar en componente: `const { cambiarEstado } = useCambioEstadoPedido();`\n3. ‚úì Renderizar botones: `{puedeCompletarse(estado) && <btn>}`\n4. ‚úì Configurar callback: `onSincronizarVentas: crearVenta`\n5. ‚úì Actualizar lista: `onActualizar(ultimoPedidoActualizado)`\n\n---\n\n## üéì Patrones Clave\n\n```typescript\n// ‚úì CORRECTO: Usar validadores antes de renderizar\n{puedeCompletarse(estado) && <button>Completar</button>}\n\n// ‚úì CORRECTO: Usar helpers para UI\n<span className={obtenerClaseEstado(estado)}>\n  {obtenerDescripcionEstado(estado)}\n</span>\n\n// ‚úì CORRECTO: Configurar callbacks una sola vez\nconst { cambiarEstado } = useCambioEstadoPedido({\n  onSincronizarVentas: crearVenta,\n  onNotificar: mostrarNotificacion\n});\n\n// ‚úó INCORRECTO: No validar ni sincronizar\nawait cambiarEstado(id, 'Completada');\n\n// ‚úó INCORRECTO: C√≥digo duplicado\nif (estado === 'Pendiente') { /* l√≥gica 1 */ }\nif (estado === 'Pendiente') { /* l√≥gica 2 */ }\n```\n\n---\n\n## üîç Debugging\n\n```javascript\n// En consola, buscar logs con:\nConsole ‚Üí Ctrl+Shift+K ‚Üí Filtrar \"CAMBIO_ESTADO\"\n\n// Ver√°s:\n[info] [CAMBIO_ESTADO] Iniciando...\n[info] [CAMBIO_ESTADO] Sincronizando...\n[info] [CAMBIO_ESTADO] Operaci√≥n completada\n```\n\n---\n\n## üìö Documentaci√≥n Completa\n\n- **Gu√≠a detallada:** [GUIA_CAMBIO_ESTADO_CENTRALIZADO.md](GUIA_CAMBIO_ESTADO_CENTRALIZADO.md)\n- **6 ejemplos:** [EjemplosIntegracionCambioEstado.tsx](src/components/EjemplosIntegracionCambioEstado.tsx)\n- **15 snippets:** [SNIPPETS_CAMBIO_ESTADO.ts](SNIPPETS_CAMBIO_ESTADO.ts)\n- **Resumen ejecutivo:** [README_CAMBIO_ESTADO_CENTRALIZADO.md](README_CAMBIO_ESTADO_CENTRALIZADO.md)\n\n---\n\n## üöÄ Pr√≥ximo Paso\n\n**Copia el snippet que necesites y √∫salo en tu componente. Listo.**\n\n---\n\n**¬øDudas? Revisa:**\n- Transici√≥n no permitida ‚Üí Ver matriz de transiciones\n- Venta no se crea ‚Üí Verificar callback onSincronizarVentas\n- Bot√≥n siempre deshabilitado ‚Üí Verificar puedeCompletarse()\n- Error no se muestra ‚Üí Configurar onNotificar\n"